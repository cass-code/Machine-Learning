draw_confusion_matrix <- function(cm) {

    # extract the confusion matrix values as data.frame
    cm_d <- as.data.frame(cm$table)
    # confusion matrix statistics as data.frame
    cm_st <-data.frame(cm$overall)
    # confusion matrix byClass to look at sensitivity and specificity etc as data.frame
    cm_cl <-data.frame(cm$byClass)

    # round the values
    cm_st$cm.overall <- round(cm_st$cm.overall,2)
    cm_cl <- round(cm_cl,2)

    # rounded percentage values
    cm_p <- as.data.frame(prop.table(cm$table))
    cm_d$Perc <- round(cm_p$Freq*100,2)

    library(ggplot2)
    library(gridExtra)
    library(grid)

    # plotting
    cm_d_p <-  ggplot(data = cm_d, aes(x = Prediction , y =  Reference, fill = Freq))+
        geom_tile() +
        geom_text(aes(label = paste("",Freq,",",Perc,"%")), color = 'black', size = 3) +
        theme_light() +
        guides(fill=FALSE)

    cm_d_p <- cm_d_p + scale_fill_distiller(palette = "Greens", direction = 1)


    # plotting the stats

    cm_cl_p <- tableGrob(cm_cl)
    cm_st_p <-  tableGrob(cm_st)

    # arranging all the graphs
    grid.arrange(cm_d_p, cm_st_p, cm_cl_p, nrow = 2, ncol = 2,
                 top=textGrob("Confusion Matrix and Statistics",gp=gpar(fontsize=25,font=1)))
}
